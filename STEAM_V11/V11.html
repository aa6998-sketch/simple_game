<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ƒå µåœ‹å° STEAM MAKER å‰µå®¢æ•™å®¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Noto Sans TC å­—å‹ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap" rel="stylesheet">
    <!-- å¼•å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
            scroll-behavior: smooth;
        }
        .steam-gradient {
            background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
        }
        .grid-bg {
            /* æ¨¡æ“¬ç…§ç‰‡ä¸­çš„é»‘è‰²å­”æ´æ¿ */
            background-color: #2a2a2a;
            background-image: radial-gradient(#1a1a1a 20%, transparent 20%);
            background-size: 40px 40px;
            background-position: 0 0;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }
        canvas {
            cursor: crosshair;
            touch-action: none; /* é˜²æ­¢è§¸æ§æ™‚æ²å‹•é é¢ */
        }
        .nav-link {
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background-color: #4ECDC4;
            transition: width 0.3s;
        }
        .nav-link:hover::after {
            width: 100%;
        }
        /* Modal å‹•ç•« */
        .modal {
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }
        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }
        /* å½±ç‰‡è£é£¾å‹•ç•« */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 7s infinite;
        }
        /* ç´™è† å¸¶è£é£¾æ•ˆæœ */
        .tape-effect {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%) rotate(-2deg);
            width: 100px;
            height: 30px;
            background-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            z-index: 10;
            backdrop-filter: blur(2px);
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- èƒŒæ™¯éŸ³æ¨‚æ§åˆ¶ -->
    <div class="fixed bottom-4 right-4 z-50 bg-white p-2 rounded-full shadow-lg flex items-center gap-2 border border-gray-200">
        <!-- å¢åŠ  autoplay å±¬æ€§ -->
        <audio id="bgMusic" loop autoplay>
            <!-- è¼•é¬†æœ‰è¶£çš„èƒŒæ™¯éŸ³æ¨‚ -->
            <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" type="audio/mp3">
        </audio>
        <button onclick="toggleMusic()" class="p-2 rounded-full hover:bg-gray-100 text-pink-500 transition">
            <i id="musicIcon" data-lucide="music" class="w-6 h-6"></i>
        </button>
        <span class="text-xs font-bold text-gray-500 pr-2">èƒŒæ™¯éŸ³æ¨‚</span>
    </div>

    <!-- å°èˆªåˆ— -->
    <nav class="bg-white shadow-md fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-28">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center gap-4">
                        <!-- æ ¡å¾½ç¶­æŒ 2 å€å¤§ (w-24 h-24) -->
                        <img src="æ ¡å¾½cuteç‰ˆ.png" alt="ä¸ƒå µåœ‹å°æ ¡å¾½" class="w-24 h-24 object-contain hover:scale-110 transition duration-300">
                        <div>
                            <h1 class="text-2xl font-black tracking-wider text-gray-900">ä¸ƒå µåœ‹å°</h1>
                            <span class="text-xs text-blue-500 font-bold tracking-[0.2em]">STEAM MAKER</span>
                        </div>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#home" class="nav-link font-bold text-gray-600 hover:text-blue-600">é¦–é </a>
                    <a href="#philosophy" class="nav-link font-bold text-gray-600 hover:text-blue-600">æ•™å­¸ç†å¿µ</a>
                    <!-- æ–°å¢é¸é … -->
                    <a href="#maker-gallery" class="nav-link font-bold text-gray-600 hover:text-blue-600">MAKERèŠ±çµ®</a>
                    <a href="#simulator" class="nav-link font-bold text-gray-600 hover:text-blue-600">ç·šä¸Šç©æœ¨ç‰†</a>
                    <a href="#gallery" class="nav-link font-bold text-gray-600 hover:text-blue-600">ä½œå“å±•ç¤º</a>
                </div>
                <div class="md:hidden flex items-center">
                    <button class="text-gray-600 hover:text-gray-900">
                        <i data-lucide="menu" class="w-8 h-8"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero å€å¡Š -->
    <section id="home" class="pt-36 pb-12 md:pt-48 md:pb-24 steam-gradient text-white relative overflow-hidden">
        <!-- è£é£¾åœ“åœˆèƒŒæ™¯ -->
        <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-10 rounded-full translate-x-1/2 -translate-y-1/2"></div>
        <div class="absolute bottom-0 left-0 w-96 h-96 bg-blue-900 opacity-10 rounded-full -translate-x-1/2 translate-y-1/2"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <!-- ä½¿ç”¨ Flexbox å»ºç«‹å·¦å³ä½ˆå±€ -->
            <div class="flex flex-col md:flex-row items-center justify-between gap-12">
                
                <!-- å·¦å´ï¼šæ–‡å­—å…§å®¹ -->
                <div class="md:w-1/2 text-center md:text-left space-y-6">
                    <h2 class="text-4xl md:text-6xl font-black drop-shadow-lg leading-tight">
                        æƒ³åƒ â€¢ å¯¦ä½œ <br>
                        <span class="text-yellow-300">å‰µæ–°æœªä¾†</span>
                    </h2>
                    <p class="text-xl md:text-2xl font-light opacity-90">
                        ä¸ƒå µåœ‹å° STEAM MAKER <br>
                        è®“å­©å­çš„å‰µæ„å‹•èµ·ä¾†ï¼Œå°‡é»å­è®Šæˆç¾å¯¦ï¼
                    </p>
                    <div class="pt-4">
                        <a href="#simulator" class="inline-block bg-white text-blue-600 font-bold py-4 px-10 rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition transform duration-200">
                            <i data-lucide="play-circle" class="inline-block w-6 h-6 mr-2 align-text-bottom"></i>
                            é«”é©—ç·šä¸Šç©æœ¨ç‰†
                        </a>
                    </div>
                </div>

                <!-- å³å´ï¼šå½±ç‰‡å±•ç¤ºå€ -->
                <div class="md:w-1/2 relative w-full max-w-lg">
                    <!-- è£é£¾æ€§å…‰æšˆ -->
                    <div class="absolute top-0 -left-4 w-72 h-72 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
                    <div class="absolute top-0 -right-4 w-72 h-72 bg-yellow-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
                    <div class="absolute -bottom-8 left-20 w-72 h-72 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"></div>
                    
                    <!-- å½±ç‰‡å®¹å™¨ -->
                    <div class="relative rounded-2xl overflow-hidden shadow-2xl border-4 border-white/30 backdrop-blur-sm transform rotate-2 hover:rotate-0 transition duration-500 bg-black/20 group">
                        <!-- ä½¿ç”¨ä¸Šå‚³çš„å½±ç‰‡æª”æ¡ˆï¼Œè¨­å®šè‡ªå‹•æ’­æ”¾ã€éœéŸ³ã€å¾ªç’° -->
                        <video autoplay loop muted playsinline class="w-full h-auto object-cover">
                            <source src="grok-video-9cac6a83-05ca-4699-ac73-2914f627a8ca.mp4" type="video/mp4">
                            æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ¨™ç±¤ã€‚
                        </video>
                        <!-- æ¨™ç±¤å·²ç§»é™¤ -->
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- STEAM ç†å¿µä»‹ç´¹ (å¯é»æ“Š) -->
    <section id="philosophy" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-bold text-gray-900">STEAM æ•™è‚²æ ¸å¿ƒ</h2>
                <div class="w-20 h-1 bg-blue-500 mx-auto mt-4 rounded"></div>
                <p class="mt-4 text-gray-600">é»æ“Šä¸‹æ–¹å¡ç‰‡ï¼Œæ·±å…¥äº†è§£å„é ˜åŸŸå…§æ¶µ</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-5 gap-6 text-center">
                <!-- S -->
                <button onclick="openModal('S')" class="p-6 rounded-xl bg-blue-50 hover:bg-blue-100 hover:-translate-y-2 transition duration-300 shadow-sm hover:shadow-md cursor-pointer group">
                    <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl font-bold group-hover:scale-110 transition">S</div>
                    <h3 class="text-xl font-bold mb-2">Science</h3>
                    <p class="text-sm text-gray-600">ç§‘å­¸æ¢ç©¶</p>
                </button>
                <!-- T -->
                <button onclick="openModal('T')" class="p-6 rounded-xl bg-green-50 hover:bg-green-100 hover:-translate-y-2 transition duration-300 shadow-sm hover:shadow-md cursor-pointer group">
                    <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl font-bold group-hover:scale-110 transition">T</div>
                    <h3 class="text-xl font-bold mb-2">Technology</h3>
                    <p class="text-sm text-gray-600">ç§‘æŠ€é‹ç”¨</p>
                </button>
                <!-- E -->
                <button onclick="openModal('E')" class="p-6 rounded-xl bg-yellow-50 hover:bg-yellow-100 hover:-translate-y-2 transition duration-300 shadow-sm hover:shadow-md cursor-pointer group">
                    <div class="w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl font-bold group-hover:scale-110 transition">E</div>
                    <h3 class="text-xl font-bold mb-2">Engineering</h3>
                    <p class="text-sm text-gray-600">å·¥ç¨‹è¨­è¨ˆ</p>
                </button>
                <!-- A -->
                <button onclick="openModal('A')" class="p-6 rounded-xl bg-red-50 hover:bg-red-100 hover:-translate-y-2 transition duration-300 shadow-sm hover:shadow-md cursor-pointer group">
                    <div class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl font-bold group-hover:scale-110 transition">A</div>
                    <h3 class="text-xl font-bold mb-2">Art</h3>
                    <p class="text-sm text-gray-600">è—è¡“ç¾æ„Ÿ</p>
                </button>
                <!-- M -->
                <button onclick="openModal('M')" class="p-6 rounded-xl bg-purple-50 hover:bg-purple-100 hover:-translate-y-2 transition duration-300 shadow-sm hover:shadow-md cursor-pointer group">
                    <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl font-bold group-hover:scale-110 transition">M</div>
                    <h3 class="text-xl font-bold mb-2">Math</h3>
                    <p class="text-sm text-gray-600">æ•¸å­¸é‚è¼¯</p>
                </button>
            </div>
        </div>
    </section>

    <!-- MAKER èŠ±çµ® (æ–°å¢å€å¡Š) -->
    <section id="maker-gallery" class="py-16 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-bold text-gray-900">MAKER èŠ±çµ®</h2>
                <div class="w-20 h-1 bg-yellow-400 mx-auto mt-4 rounded"></div>
                <p class="mt-4 text-gray-600">å­©å­å€‘å°ˆæ³¨å‰µä½œçš„ç²¾å½©ç¬é–“</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- åœ–ç‰‡ 1 - æ·ºç²‰ç´… -->
                <div class="relative group cursor-pointer hover:z-10 transition-all duration-300 transform hover:-rotate-2">
                    <div class="bg-pink-100 p-3 shadow-lg rounded-sm transform rotate-1 border border-gray-200">
                        <div class="tape-effect bg-yellow-100/80"></div>
                        <div class="overflow-hidden aspect-[4/3]">
                            <img src="1.jpg" alt="èŠ±çµ®ç…§ç‰‡ 1" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        </div>
                        <div class="text-center pt-3 font-handwriting text-gray-600 text-sm font-bold">å°ˆæ³¨æ™‚åˆ»</div>
                    </div>
                </div>
                <!-- åœ–ç‰‡ 2 - ç«ç‘°ç²‰ -->
                <div class="relative group cursor-pointer hover:z-10 transition-all duration-300 transform hover:rotate-2">
                    <div class="bg-rose-100 p-3 shadow-lg rounded-sm transform -rotate-1 border border-gray-200">
                        <div class="tape-effect bg-blue-100/80"></div>
                        <div class="overflow-hidden aspect-[4/3]">
                            <img src="2.jpg" alt="èŠ±çµ®ç…§ç‰‡ 2" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        </div>
                        <div class="text-center pt-3 font-handwriting text-gray-600 text-sm font-bold">å‹•æ‰‹å¯¦ä½œ</div>
                    </div>
                </div>
                <!-- åœ–ç‰‡ 3 - ç´«ç²‰ç´… (Fuchsia) -->
                <div class="relative group cursor-pointer hover:z-10 transition-all duration-300 transform hover:-rotate-1">
                    <div class="bg-fuchsia-100 p-3 shadow-lg rounded-sm transform rotate-2 border border-gray-200">
                        <div class="tape-effect bg-green-100/80"></div>
                        <div class="overflow-hidden aspect-[4/3]">
                            <img src="3.jpg" alt="èŠ±çµ®ç…§ç‰‡ 3" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        </div>
                        <div class="text-center pt-3 font-handwriting text-gray-600 text-sm font-bold">å‰µæ„æ¿€ç›ª</div>
                    </div>
                </div>
                <!-- åœ–ç‰‡ 4 - ç´…ç²‰è‰² (Red-100 è¿‘ç²‰è‰²) -->
                <div class="relative group cursor-pointer hover:z-10 transition-all duration-300 transform hover:rotate-2">
                    <div class="bg-red-100 p-3 shadow-lg rounded-sm transform -rotate-2 border border-gray-200">
                        <div class="tape-effect bg-pink-100/80"></div>
                        <div class="overflow-hidden aspect-[4/3]">
                            <img src="4.jpg" alt="èŠ±çµ®ç…§ç‰‡ 4" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        </div>
                        <div class="text-center pt-3 font-handwriting text-gray-600 text-sm font-bold">å¸«ç”Ÿäº’å‹•</div>
                    </div>
                </div>
                <!-- åœ–ç‰‡ 5 - ä¸­ç²‰ç´… (Pink-200) -->
                <div class="relative group cursor-pointer hover:z-10 transition-all duration-300 transform hover:-rotate-2">
                    <div class="bg-pink-200 p-3 shadow-lg rounded-sm transform rotate-1 border border-gray-200">
                        <div class="tape-effect bg-purple-100/80"></div>
                        <div class="overflow-hidden aspect-[4/3]">
                            <img src="5.jpg" alt="èŠ±çµ®ç…§ç‰‡ 5" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        </div>
                        <div class="text-center pt-3 font-handwriting text-gray-600 text-sm font-bold">åŒå„•åˆä½œ</div>
                    </div>
                </div>
                <!-- åœ–ç‰‡ 6 - ä¸­ç«ç‘°ç²‰ (Rose-200) -->
                <div class="relative group cursor-pointer hover:z-10 transition-all duration-300 transform hover:rotate-1">
                    <div class="bg-rose-200 p-3 shadow-lg rounded-sm transform -rotate-1 border border-gray-200">
                        <div class="tape-effect bg-orange-100/80"></div>
                        <div class="overflow-hidden aspect-[4/3]">
                            <img src="6.jpg" alt="èŠ±çµ®ç…§ç‰‡ 6" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        </div>
                        <div class="text-center pt-3 font-handwriting text-gray-600 text-sm font-bold">æˆæœå±•ç¤º</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- äº’å‹•ç©æœ¨ç‰† Simulator -->
    <section id="simulator" class="py-12 bg-white">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-end mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900 flex items-center gap-2">
                        <i data-lucide="settings" class="text-blue-600"></i>
                        ç·šä¸Šç©æœ¨å‰µå®¢ç‰†
                    </h2>
                    <p class="text-gray-600 mt-2">ä½¿ç”¨å·¦å´æ›´å¤šå…ƒçš„é›¶ä»¶ï¼Œæ‰“é€ ä½ çš„å‰µæ„æ©Ÿé—œï¼</p>
                </div>
                <div class="flex gap-3 mt-4 md:mt-0">
                    <button onclick="clearBoard()" class="px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 font-bold transition flex items-center gap-2">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> æ¸…ç©º
                    </button>
                    <button id="toggleRunBtn" onclick="toggleSimulation()" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 font-bold shadow-lg transition flex items-center gap-2">
                        <i data-lucide="play" class="w-5 h-5"></i> <span id="runBtnText">é–‹å§‹é‹è½‰</span>
                    </button>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-6">
                <!-- å·¥å…·ç®± -->
                <div class="lg:w-72 bg-white p-4 rounded-xl shadow-lg border border-gray-200 max-h-[800px] overflow-y-auto">
                    <h3 class="font-bold text-gray-700 mb-4 border-b pb-2 flex items-center gap-2">
                        <i data-lucide="box" class="w-4 h-4"></i> é›¶ä»¶ç®±
                    </h3>
                    
                    <div class="space-y-4">
                        <!-- é½’è¼ªå€ -->
                        <div>
                            <p class="text-xs text-gray-400 font-bold mb-2">å‹•åŠ›é½’è¼ª (Gears)</p>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="selectTool('gear', 'red', 40, 12)" class="tool-btn hover:bg-gray-50 p-1 rounded border border-transparent hover:border-gray-200 flex flex-col items-center group">
                                    <div class="w-8 h-8 rounded-full border-2 border-dashed border-red-500 group-hover:rotate-45 transition"></div>
                                    <span class="text-[10px] mt-1">ç´…(12é½’)</span>
                                </button>
                                <button onclick="selectTool('gear', 'blue', 60, 20)" class="tool-btn hover:bg-gray-50 p-1 rounded border border-transparent hover:border-gray-200 flex flex-col items-center group">
                                    <div class="w-10 h-10 rounded-full border-2 border-dashed border-blue-500 group-hover:rotate-45 transition"></div>
                                    <span class="text-[10px] mt-1">è—(20é½’)</span>
                                </button>
                                <button onclick="selectTool('gear', 'yellow', 80, 28)" class="tool-btn hover:bg-gray-50 p-1 rounded border border-transparent hover:border-gray-200 flex flex-col items-center group">
                                    <div class="w-12 h-12 rounded-full border-2 border-dashed border-yellow-500 group-hover:rotate-45 transition"></div>
                                    <span class="text-[10px] mt-1">é»ƒ(28é½’)</span>
                                </button>
                            </div>
                        </div>

                        <!-- çµæ§‹å€ -->
                        <div>
                            <p class="text-xs text-gray-400 font-bold mb-2">çµæ§‹ç©æœ¨ (Beams)</p>
                            <div class="space-y-2">
                                <button onclick="selectTool('beam', '#4ade80', 120, 20)" class="w-full tool-btn hover:bg-gray-50 p-2 rounded border border-transparent hover:border-gray-200 flex items-center gap-2">
                                    <div class="w-16 h-3 bg-green-400 rounded-full"></div>
                                    <span class="text-xs">é•·æ¢ (5å­”)</span>
                                </button>
                                <button onclick="selectTool('beam', '#a78bfa', 80, 20)" class="w-full tool-btn hover:bg-gray-50 p-2 rounded border border-transparent hover:border-gray-200 flex items-center gap-2">
                                    <div class="w-10 h-3 bg-purple-400 rounded-full"></div>
                                    <span class="text-xs">çŸ­æ¢ (3å­”)</span>
                                </button>
                                <!-- Lå‹ -->
                                <button onclick="selectTool('l-beam', '#fb923c', 80, 20)" class="w-full tool-btn hover:bg-gray-50 p-2 rounded border border-transparent hover:border-gray-200 flex items-center gap-2">
                                    <div class="relative w-8 h-8">
                                        <div class="absolute top-0 left-0 w-3 h-8 bg-orange-400 rounded-full"></div>
                                        <div class="absolute bottom-0 left-0 w-8 h-3 bg-orange-400 rounded-full"></div>
                                    </div>
                                    <span class="text-xs">Lå‹è½‰è§’</span>
                                </button>
                                <!-- Tå‹ -->
                                <button onclick="selectTool('t-beam', '#22d3ee', 80, 20)" class="w-full tool-btn hover:bg-gray-50 p-2 rounded border border-transparent hover:border-gray-200 flex items-center gap-2">
                                    <div class="relative w-8 h-8 flex items-center justify-center">
                                        <div class="absolute w-3 h-8 bg-cyan-400 rounded-full"></div>
                                        <div class="absolute w-8 h-3 bg-cyan-400 rounded-full"></div>
                                    </div>
                                    <span class="text-xs">Tå‹é€£æ¥</span>
                                </button>
                            </div>
                        </div>

                        <!-- è£é£¾å€ -->
                        <div>
                            <p class="text-xs text-gray-400 font-bold mb-2">ç‰¹æ®Šé›¶ä»¶ (Special)</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="selectTool('fan', '#ec4899', 100, 0)" class="tool-btn hover:bg-gray-50 p-2 rounded border border-transparent hover:border-gray-200 flex flex-col items-center group">
                                    <i data-lucide="fan" class="text-pink-500 w-8 h-8 group-hover:rotate-90 transition"></i>
                                    <span class="text-[10px] mt-1">é¢¨æ‰‡è‘‰ç‰‡</span>
                                </button>
                                <button onclick="selectTool('axle', '#94a3b8', 20, 0)" class="tool-btn hover:bg-gray-50 p-2 rounded border border-transparent hover:border-gray-200 flex flex-col items-center">
                                    <div class="w-4 h-4 rounded-full bg-slate-400 border-2 border-slate-600"></div>
                                    <span class="text-[10px] mt-1">å›ºå®šè»¸</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-3 bg-blue-50 rounded text-xs text-blue-700">
                        <p class="font-bold">ğŸ’¡ å°æŠ€å·§ï¼š</p>
                        <ul class="list-disc ml-4 mt-1 space-y-1">
                            <li>Lå‹èˆ‡Tå‹ç©æœ¨å¯é€£æ¥è¤‡é›œçµæ§‹ã€‚</li>
                            <li>é¢¨æ‰‡è‘‰ç‰‡å®‰è£åœ¨é½’è¼ªä¸Šæœƒè·Ÿè‘—è½‰å‹•å–”ï¼</li>
                        </ul>
                    </div>
                </div>

                <!-- ç•«å¸ƒå€åŸŸ -->
                <div class="flex-1 relative rounded-xl overflow-hidden shadow-2xl border-4 border-gray-700 h-[600px] bg-neutral-800">
                    <!-- Canvas -->
                    <canvas id="makerCanvas" class="grid-bg w-full h-full block"></canvas>
                    
                    <!-- ç›®å‰é¸æ“‡å·¥å…·æç¤º -->
                    <div id="activeToolDisplay" class="absolute top-4 left-4 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-sm font-bold shadow-md hidden pointer-events-none text-blue-800 border border-blue-200">
                        ç›®å‰æ‰‹æŒ: <span id="toolName">ç„¡</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ä½œå“å±•ç¤º (ç¯„ä¾‹è¼‰å…¥) -->
    <section id="gallery" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-10">å°å°å‰µå®¢ä½œå“é›†</h2>
            <p class="text-center text-gray-500 mb-8 -mt-6">é»æ“Šä¸‹æ–¹ç¯„ä¾‹ï¼Œå³å¯åœ¨ç©æœ¨ç‰†ä¸Šè¼‰å…¥ä½œå“ï¼</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- ç¯„ä¾‹ä¸€ -->
                <div onclick="loadPreset('arm')" class="rounded-lg overflow-hidden shadow-lg group relative cursor-pointer hover:shadow-2xl transition transform hover:-translate-y-1 bg-white border border-gray-100">
                    <div class="h-48 bg-blue-50 flex items-center justify-center overflow-hidden relative">
                        <i data-lucide="grab" class="w-20 h-20 text-blue-400 opacity-80 group-hover:scale-110 transition duration-500"></i>
                        <div class="absolute bottom-2 right-2 bg-blue-600 text-white text-xs px-2 py-1 rounded">é»æ“Šè¼‰å…¥</div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-800">ç¯„ä¾‹ä¸€ï¼šé€£å‹•æ©Ÿæ¢°æ‰‹è‡‚</h3>
                        <p class="text-gray-500 text-sm mt-1">åˆ©ç”¨é€£æ¡¿æ©Ÿæ§‹èˆ‡é½’è¼ªå‚³å‹•ï¼Œæ¨¡æ“¬æ‰‹è‡‚æŠ“å–å‹•ä½œã€‚</p>
                        <div class="mt-3 flex gap-2">
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">äº”å¹´ç´š</span>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">å·¥ç¨‹</span>
                        </div>
                    </div>
                </div>

                <!-- ç¯„ä¾‹äºŒ -->
                <div onclick="loadPreset('ferris')" class="rounded-lg overflow-hidden shadow-lg group relative cursor-pointer hover:shadow-2xl transition transform hover:-translate-y-1 bg-white border border-gray-100">
                    <div class="h-48 bg-yellow-50 flex items-center justify-center overflow-hidden relative">
                        <i data-lucide="loader-2" class="w-20 h-20 text-yellow-400 opacity-80 group-hover:rotate-90 transition duration-700"></i>
                        <div class="absolute bottom-2 right-2 bg-yellow-600 text-white text-xs px-2 py-1 rounded">é»æ“Šè¼‰å…¥</div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-800">ç¯„ä¾‹äºŒï¼šéŠæ¨‚åœ’æ‘©å¤©è¼ª</h3>
                        <p class="text-gray-500 text-sm mt-1">å¤§å‹é½’è¼ªå¸¶å‹•å¤–åœˆçµæ§‹ï¼Œå±•ç¾ç©©å®šçš„åœ“å‘¨é‹å‹•ã€‚</p>
                        <div class="mt-3 flex gap-2">
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">å››å¹´ç´š</span>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">æ•¸å­¸</span>
                        </div>
                    </div>
                </div>

                <!-- ç¯„ä¾‹ä¸‰ -->
                <div onclick="loadPreset('car')" class="rounded-lg overflow-hidden shadow-lg group relative cursor-pointer hover:shadow-2xl transition transform hover:-translate-y-1 bg-white border border-gray-100">
                    <div class="h-48 bg-green-50 flex items-center justify-center overflow-hidden relative">
                        <i data-lucide="car" class="w-20 h-20 text-green-400 opacity-80 group-hover:translate-x-4 transition duration-500"></i>
                        <div class="absolute bottom-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded">é»æ“Šè¼‰å…¥</div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-800">ç¯„ä¾‹ä¸‰ï¼šæ©¡çš®ç­‹å‹•åŠ›è»Š</h3>
                        <p class="text-gray-500 text-sm mt-1">é€éå¤šç´šé½’è¼ªè®Šé€Ÿï¼Œå°‡å‹•åŠ›å‚³è¼¸è‡³è¼ªå­ã€‚</p>
                        <div class="mt-3 flex gap-2">
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">å…­å¹´ç´š</span>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">ç§‘å­¸</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <div class="mb-6 md:mb-0 text-center md:text-left">
                <h3 class="text-2xl font-bold">ä¸ƒå µåœ‹å° STEAM MAKER</h3>
                <p class="text-gray-400 mt-2">å•Ÿç™¼å­©å­æœªä¾†çš„ç„¡é™å¯èƒ½</p>
            </div>
            <div class="text-gray-500 text-sm text-center md:text-right">
                <p>&copy; Keelung Municipal Qidu Elementary School.</p>
                <p>Designed for STEAM Education.</p>
            </div>
        </div>
    </footer>

    <!-- STEAM è©³è§£ Modals -->
    <div id="steamModal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 modal">
        <div class="bg-white rounded-2xl shadow-2xl w-11/12 md:w-1/2 max-w-2xl overflow-hidden transform transition-all scale-95" id="modalContent">
            <div id="modalHeader" class="p-6 text-white bg-blue-600 flex justify-between items-center">
                <h3 id="modalTitle" class="text-2xl font-bold">æ¨™é¡Œ</h3>
                <button onclick="closeModal()" class="text-white hover:text-gray-200">
                    <i data-lucide="x" class="w-8 h-8"></i>
                </button>
            </div>
            <div class="p-8">
                <div id="modalBody" class="text-gray-700 text-lg leading-relaxed space-y-4">
                    <!-- å…§å®¹å‹•æ…‹å¡«å…… -->
                </div>
                <div class="mt-8 flex justify-end">
                    <button onclick="closeModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-800 font-bold transition">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // åˆå§‹åŒ– Icons
        lucide.createIcons();

        /* --- Audio Control --- */
        const bgMusic = document.getElementById('bgMusic');
        let isMusicPlaying = false;
        
        function updateMusicUI(playing) {
             const icon = document.getElementById('musicIcon');
             const btn = icon.parentElement;
             if(playing) {
                // æ’­æ”¾ä¸­ï¼šé¡¯ç¤ºéŸ³æ³¢åœ–ç¤ºèˆ‡ç²‰ç´…è‰²èƒŒæ™¯
                icon.innerHTML = '<path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle><path d="M2 10v3"/><path d="M22 10v3"/>';
                btn.classList.add('bg-pink-100');
             } else {
                // æš«åœä¸­ï¼šé¡¯ç¤ºä¸€èˆ¬éŸ³ç¬¦åœ–ç¤º
                icon.innerHTML = '<path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle>';
                btn.classList.remove('bg-pink-100');
             }
             lucide.createIcons();
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                isMusicPlaying = false;
            } else {
                bgMusic.volume = 0.3;
                bgMusic.play().catch(e => console.log("Audio play prevented"));
                isMusicPlaying = true;
            }
            updateMusicUI(isMusicPlaying);
        }

        // å˜—è©¦è‡ªå‹•æ’­æ”¾èˆ‡åˆå§‹åŒ–ç‹€æ…‹
        document.addEventListener('DOMContentLoaded', () => {
             bgMusic.volume = 0.3;
             
             // æª¢æŸ¥æ˜¯å¦å›  autoplay å±¬æ€§å·²é–‹å§‹æ’­æ”¾
             if (!bgMusic.paused) {
                 isMusicPlaying = true;
                 updateMusicUI(true);
             } else {
                 // å˜—è©¦ç¨‹å¼åŒ–æ’­æ”¾
                 bgMusic.play().then(() => {
                     isMusicPlaying = true;
                     updateMusicUI(true);
                 }).catch(() => {
                     // è‡ªå‹•æ’­æ”¾è¢«ç€è¦½å™¨é˜»æ“‹
                     console.log("è‡ªå‹•æ’­æ”¾è¢«é˜»æ“‹ï¼Œç­‰å¾…ä½¿ç”¨è€…äº’å‹•");
                     isMusicPlaying = false;
                     updateMusicUI(false);
                     
                     // åŠ å…¥ä¸€æ¬¡æ€§é»æ“Šç›£è½å™¨ï¼Œä½¿ç”¨è€…é»æ“Šä»»æ„è™•å³é–‹å§‹æ’­æ”¾
                     document.body.addEventListener('click', () => {
                         if(!isMusicPlaying) {
                             bgMusic.play();
                             isMusicPlaying = true;
                             updateMusicUI(true);
                         }
                     }, { once: true });
                 });
             }
        });

        /* --- STEAM Modal Logic --- */
        const steamContent = {
            'S': {
                title: 'Science (ç§‘å­¸)',
                color: 'bg-blue-600',
                body: '<p>åœ¨å‰µå®¢ç‰†ä¸­ï¼Œç§‘å­¸é«”ç¾åœ¨<strong>ã€Œè§€å¯Ÿèˆ‡é©—è­‰ã€</strong>ã€‚å­©å­å€‘é€éè§€å¯Ÿé½’è¼ªçš„å¤§å°å¦‚ä½•å½±éŸ¿è½‰é€Ÿï¼ˆé½’è¼ªæ¯”ï¼‰ï¼Œç†è§£æ©Ÿæ¢°å‚³å‹•çš„ç‰©ç†åŸç†ã€‚</p><p>ä¾‹å¦‚ï¼šå¤§é½’è¼ªå¸¶å‹•å°é½’è¼ªæœƒåŠ é€Ÿï¼Œé€™å°±æ˜¯è®Šé€Ÿç®±çš„åŸºæœ¬åŸç†ã€‚é€éå‹•æ‰‹å¯¦ä½œï¼Œå°‡æŠ½è±¡çš„ç‰©ç†å…¬å¼è½‰åŒ–ç‚ºå¯è¦‹çš„ç¾è±¡ã€‚</p>'
            },
            'T': {
                title: 'Technology (ç§‘æŠ€)',
                color: 'bg-green-600',
                body: '<p>ç§‘æŠ€ä¸åªæ˜¯é›»è…¦ï¼Œæ›´åŒ…å«äº†<strong>ã€Œå·¥å…·çš„ä½¿ç”¨ã€</strong>ã€‚åœ¨æˆ‘å€‘çš„èª²ç¨‹ä¸­ï¼Œé€™é¢å‰µå®¢ç‰†æœ¬èº«å°±æ˜¯ä¸€ç¨®ä½ç§‘æŠ€ï¼ˆLow-Techï¼‰çš„æ¨¡æ“¬å·¥å…·ã€‚</p><p>å­¸ç”Ÿå­¸ç¿’å¦‚ä½•é‹ç”¨é©ç•¶çš„é›¶ä»¶ï¼ˆå¦‚é€£æ¥æ¡¿ã€å›ºå®šè»¸ï¼‰ä¾†é”æˆç›®çš„ï¼Œé€™å°±æ˜¯å–„ç”¨ç§‘æŠ€è§£æ±ºå•é¡Œçš„åŸºç¤ç´ é¤Šã€‚</p>'
            },
            'E': {
                title: 'Engineering (å·¥ç¨‹)',
                color: 'bg-yellow-500',
                body: '<p>å·¥ç¨‹æ˜¯é—œæ–¼<strong>ã€Œçµæ§‹èˆ‡å»ºé€ ã€</strong>ã€‚å¦‚ä½•è®“é¢¨æ‰‡è½‰å‹•æ™‚ä¸æœƒæ‰è½ï¼Ÿå¦‚ä½•è®“Lå‹ç©æœ¨ç©©å›ºåœ°æ”¯æ’é¦¬é”ï¼Ÿ</p><p>åœ¨æ­å»ºéç¨‹ä¸­ï¼Œå­©å­å¿…é ˆè€ƒæ…®é‡å¿ƒã€æ”¯æ’é»èˆ‡çµæ§‹å¼·åº¦ï¼Œé€™å°±æ˜¯å°å°çµæ§‹å·¥ç¨‹å¸«çš„æ—¥å¸¸æŒ‘æˆ°ï¼</p>'
            },
            'A': {
                title: 'Art (è—è¡“)',
                color: 'bg-red-500',
                body: '<p>STEAM ä¸­çš„ A ä»£è¡¨è—è¡“ï¼Œå¼·èª¿<strong>ã€Œç¾æ„Ÿèˆ‡è¨­è¨ˆã€</strong>ã€‚æ©Ÿæ¢°è£ç½®ä¸åƒ…è¦èƒ½å‹•ï¼Œé‚„è¦æœ‰ç¾æ„Ÿã€‚</p><p>é€éè‰²å½©è¨ˆç•«ï¼ˆä¾‹å¦‚ç´…è‰²é½’è¼ªé…ç¶ è‰²æ”¯æ¶ï¼‰ã€å°ç¨±æ’åˆ—ï¼Œå­©å­å€‘åœ¨ç†æ€§çš„æ©Ÿæ¢°çµæ§‹ä¸­èå…¥æ„Ÿæ€§çš„ç¾å­¸è¨­è¨ˆã€‚</p>'
            },
            'M': {
                title: 'Math (æ•¸å­¸)',
                color: 'bg-purple-600',
                body: '<p>æ•¸å­¸æ˜¯æ©Ÿæ¢°é‹ä½œçš„åŸºçŸ³ã€‚<strong>ã€Œæ¯”ä¾‹èˆ‡å¹¾ä½•ã€</strong>ç„¡è™•ä¸åœ¨ã€‚</p><ul class="list-disc pl-5"><li><strong>é½’è¼ªæ¯”</strong>ï¼š20é½’å¸¶å‹•40é½’ï¼Œè½‰é€Ÿæ˜¯ 2:1ã€‚</li><li><strong>ç©ºé–“å¹¾ä½•</strong>ï¼šè¨ˆç®—å­”æ´è·é›¢ï¼Œç¢ºä¿é½’è¼ªèƒ½ç²¾ç¢ºåš™åˆã€‚</li></ul>'
            }
        };

        function openModal(type) {
            const data = steamContent[type];
            document.getElementById('modalTitle').innerText = data.title;
            document.getElementById('modalBody').innerHTML = data.body;
            
            const header = document.getElementById('modalHeader');
            header.className = `p-6 text-white flex justify-between items-center ${data.color}`;
            
            const modal = document.getElementById('steamModal');
            const content = document.getElementById('modalContent');
            modal.classList.add('active');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
        }

        function closeModal() {
            const modal = document.getElementById('steamModal');
            const content = document.getElementById('modalContent');
            modal.classList.remove('active');
            content.classList.add('scale-95');
            content.classList.remove('scale-100');
        }

        /* --- Canvas & Game Logic --- */
        const canvas = document.getElementById('makerCanvas');
        const ctx = canvas.getContext('2d');
        const GRID_SIZE = 40; 
        
        function resizeCanvas() {
            const parent = canvas.parentElement;
            canvas.width = parent.clientWidth;
            canvas.height = parent.clientHeight;
            draw();
        }
        window.addEventListener('resize', resizeCanvas);

        let items = [];
        let selectedTool = null;
        let isDragging = false;
        let dragItem = null;
        let isRunning = false;
        let animationFrameId;
        let baseRotation = 0; 

        // é è¨­è¼‰å…¥åŠŸèƒ½
        window.loadPreset = function(type) {
            stopSimulation();
            items = []; // æ¸…ç©º
            
            // æ²å‹•åˆ°æ¨¡æ“¬å™¨
            document.getElementById('simulator').scrollIntoView({behavior: 'smooth'});

            // æ¨¡æ“¬è³‡æ–™
            if (type === 'arm') {
                // æ©Ÿæ¢°æ‰‹è‡‚æ¨¡æ“¬
                items.push({type: 'beam', color: '#4ade80', size: 120, x: 200, y: 300, id: 1});
                items.push({type: 'beam', color: '#a78bfa', size: 80, x: 200, y: 260, id: 2});
                items.push({type: 'gear', color: 'blue', size: 60, teeth: 20, x: 200, y: 300, id: 3, isDriver: true});
                items.push({type: 'gear', color: 'red', size: 40, teeth: 12, x: 250, y: 300, id: 4});
                items.push({type: 'l-beam', color: '#fb923c', size: 80, x: 250, y: 260, id: 5}); // å¤¾çˆªéƒ¨åˆ†
                items.push({type: 'axle', color: '#94a3b8', size: 20, x: 200, y: 300, id: 6});
            } else if (type === 'ferris') {
                // æ‘©å¤©è¼ªæ¨¡æ“¬
                const cx = canvas.width / 2;
                const cy = canvas.height / 2;
                items.push({type: 'gear', color: 'yellow', size: 80, teeth: 28, x: cx, y: cy, id: 1, isDriver: true});
                // å››å‘¨çš„å°è‰™
                items.push({type: 'beam', color: '#4ade80', size: 120, x: cx, y: cy, id: 2});
                items.push({type: 'beam', color: '#4ade80', size: 120, x: cx, y: cy, rotation90: true, id: 3}); // å‚ç›´
                items.push({type: 'gear', color: 'red', size: 40, teeth: 12, x: cx-60, y: cy, id: 4});
                items.push({type: 'gear', color: 'red', size: 40, teeth: 12, x: cx+60, y: cy, id: 5});
                items.push({type: 'gear', color: 'red', size: 40, teeth: 12, x: cx, y: cy-60, id: 6});
                items.push({type: 'gear', color: 'red', size: 40, teeth: 12, x: cx, y: cy+60, id: 7});
            } else if (type === 'car') {
                // è»Šå­
                items.push({type: 'beam', color: '#4ade80', size: 120, x: 160, y: 300, id: 1});
                items.push({type: 'beam', color: '#4ade80', size: 120, x: 280, y: 300, id: 2});
                items.push({type: 'gear', color: 'yellow', size: 80, teeth: 28, x: 120, y: 300, id: 3}); // å¾Œè¼ª
                items.push({type: 'gear', color: 'yellow', size: 80, teeth: 28, x: 320, y: 300, id: 4}); // å‰è¼ª
                items.push({type: 'gear', color: 'blue', size: 60, teeth: 20, x: 220, y: 260, id: 5, isDriver: true}); // å¼•æ“
                items.push({type: 'fan', color: '#ec4899', size: 100, x: 220, y: 260, id: 6}); // èºæ—‹æ§³å‹•åŠ›
            }
            
            draw();
            // è‡ªå‹•é–‹å§‹
            setTimeout(() => {
                if(!isRunning) toggleSimulation();
            }, 500);
        };

        window.selectTool = function(type, color, size, teeth) {
            selectedTool = { type, color, size, teeth };
            
            const toolNameDisplay = document.getElementById('toolName');
            const toolDisplay = document.getElementById('activeToolDisplay');
            
            let name = "";
            if(type === 'gear') name = `é½’è¼ª (${teeth}é½’)`;
            else if(type === 'beam') name = `é•·æ¢ç©æœ¨`;
            else if(type === 'l-beam') name = `Lå‹ç©æœ¨`;
            else if(type === 't-beam') name = `Tå‹ç©æœ¨`;
            else if(type === 'fan') name = `é¢¨æ‰‡è‘‰ç‰‡`;
            else if(type === 'axle') name = `å›ºå®šè»¸`;

            toolNameDisplay.innerText = name;
            toolDisplay.classList.remove('hidden');
        };

        window.clearBoard = function() {
            items = [];
            stopSimulation();
            draw();
        };

        window.toggleSimulation = function() {
            isRunning = !isRunning;
            const btn = document.getElementById('toggleRunBtn');
            const btnText = document.getElementById('runBtnText');
            
            if(isRunning) {
                btn.classList.remove('bg-green-500', 'hover:bg-green-600');
                btn.classList.add('bg-orange-500', 'hover:bg-orange-600');
                btn.innerHTML = `<i data-lucide="pause" class="w-5 h-5"></i> åœæ­¢é‹è½‰`;
                lucide.createIcons();
                animate();
            } else {
                stopSimulation();
                btn.classList.add('bg-green-500', 'hover:bg-green-600');
                btn.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                btn.innerHTML = `<i data-lucide="play" class="w-5 h-5"></i> é–‹å§‹é‹è½‰`;
                lucide.createIcons();
            }
        };

        function stopSimulation() {
            isRunning = false;
            cancelAnimationFrame(animationFrameId);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // åˆ†å±¤ç¹ªè£½ï¼šåº•å±¤ Beam -> ä¸­å±¤ Gear -> ä¸Šå±¤ Decoration/Axle
            items.filter(i => i.type.includes('beam')).forEach(drawItem);
            items.filter(i => i.type === 'gear').forEach(drawItem);
            items.filter(i => i.type === 'fan' || i.type === 'axle').forEach(drawItem);
        }

        function drawItem(item) {
            ctx.save();
            ctx.translate(item.x, item.y);
            
            // æ—‹è½‰é‚è¼¯
            let rotation = 0;
            
            // å¦‚æœæ˜¯ç‰¹æ®Šç¯„ä¾‹ä¸­çš„å‚ç›´ç‰©ä»¶
            if(item.rotation90) rotation += Math.PI/2;

            if (isRunning && (item.type === 'gear' || item.type === 'fan')) {
                // ç°¡å–®å‹•ç•«ï¼šåŸºæ–¼åº§æ¨™è¨ˆç®—æ—‹è½‰æ–¹å‘ï¼Œè£½é€ é€£å‹•éŒ¯è¦º
                const direction = (Math.floor(item.x / 10) + Math.floor(item.y / 10)) % 2 === 0 ? 1 : -1;
                rotation += baseRotation * direction;
            }

            ctx.rotate(rotation);

            if (item.type === 'gear') {
                drawGear(item);
            } else if (item.type === 'beam') {
                drawBeam(item.size, 20, item.color);
            } else if (item.type === 'l-beam') {
                drawLBeam(item.color);
            } else if (item.type === 't-beam') {
                drawTBeam(item.color);
            } else if (item.type === 'fan') {
                drawFan(item.color, item.size);
            } else if (item.type === 'axle') {
                drawAxle();
            }

            ctx.restore();
        }

        // --- å„ç¨®é›¶ä»¶çš„ç¹ªåœ–å‡½æ•¸ ---

        function drawGear(item) {
            ctx.fillStyle = item.color;
            const outerRadius = item.size / 2;
            const innerRadius = outerRadius - 5;
            const numTeeth = item.teeth || 12;

            ctx.beginPath();
            for (let i = 0; i < numTeeth * 2; i++) {
                const angle = (Math.PI * 2 * i) / (numTeeth * 2);
                const r = (i % 2 === 0) ? outerRadius : innerRadius;
                ctx.lineTo(Math.cos(angle) * r, Math.sin(angle) * r);
            }
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = "rgba(0,0,0,0.2)";
            ctx.lineWidth = 2;
            ctx.stroke();

            // ä¸­å¿ƒè»¸
            ctx.beginPath();
            ctx.arc(0, 0, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#eee';
            ctx.fill();
            ctx.stroke();
        }

        function drawBeam(w, h, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.roundRect(-w/2, -h/2, w, h, 10);
            ctx.fill();
            // å­”æ´
            ctx.fillStyle = '#2a2a2a'; 
            const holes = Math.floor(w / 20);
            const startX = -((holes-1) * 20) / 2;
            for(let k=0; k<holes; k++) {
                ctx.beginPath();
                ctx.arc(startX + k*20, 0, 4, 0, Math.PI*2);
                ctx.fill();
            }
        }

        function drawLBeam(color) {
            ctx.fillStyle = color;
            // å‚ç›´éƒ¨åˆ†
            ctx.beginPath();
            ctx.roundRect(-10, -40, 20, 80, 10);
            ctx.fill();
            // æ°´å¹³éƒ¨åˆ†
            ctx.beginPath();
            ctx.roundRect(-10, 20, 60, 20, 10);
            ctx.fill();
            
            // å­”æ´ (ç°¡åŒ–)
            ctx.fillStyle = '#2a2a2a';
            ctx.beginPath(); ctx.arc(0, -30, 4, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(0, -10, 4, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(0, 10, 4, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(0, 30, 4, 0, Math.PI*2); ctx.fill(); // è½‰è§’
            ctx.beginPath(); ctx.arc(20, 30, 4, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(40, 30, 4, 0, Math.PI*2); ctx.fill();
        }

        function drawTBeam(color) {
            ctx.fillStyle = color;
            // å‚ç›´
            ctx.beginPath();
            ctx.roundRect(-10, -40, 20, 80, 10);
            ctx.fill();
            // æ°´å¹³
            ctx.beginPath();
            ctx.roundRect(-40, -10, 80, 20, 10);
            ctx.fill();
            
            // ä¸­å¿ƒå­”
            ctx.fillStyle = '#2a2a2a';
            ctx.beginPath(); ctx.arc(0, 0, 4, 0, Math.PI*2); ctx.fill();
        }

        function drawFan(color, size) {
            ctx.fillStyle = color;
            const radius = size/2;
            // ç•«ä¸‰å€‹è‘‰ç‰‡
            for(let i=0; i<3; i++) {
                ctx.save();
                ctx.rotate(i * (Math.PI*2/3));
                ctx.beginPath();
                ctx.ellipse(0, -radius/2, 10, radius/2, 0, 0, Math.PI*2);
                ctx.fill();
                ctx.restore();
            }
            // ä¸­å¿ƒå¸½
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(0, 0, 8, 0, Math.PI*2); ctx.fill();
        }

        function drawAxle() {
            ctx.fillStyle = '#94a3b8';
            ctx.beginPath(); ctx.arc(0, 0, 8, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#475569'; ctx.lineWidth=2; ctx.stroke();
            // åå­—ç´‹è·¯
            ctx.beginPath(); ctx.moveTo(-4,0); ctx.lineTo(4,0); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,-4); ctx.lineTo(0,4); ctx.stroke();
        }

        function animate() {
            if (!isRunning) return;
            baseRotation += 0.05; 
            draw();
            animationFrameId = requestAnimationFrame(animate);
        }

        // äº’å‹•ç›¸é—œ
        function getMousePos(evt) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }

        function snapToGrid(val) {
            return Math.round(val / (GRID_SIZE/2)) * (GRID_SIZE/2);
        }

        canvas.addEventListener('mousedown', (e) => {
            const pos = getMousePos(e);
            
            // é»é¸é‚è¼¯
            for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                const dx = pos.x - item.x;
                const dy = pos.y - item.y;
                const hitDist = 30; // ç°¡åŒ–åˆ¤å®šå€åŸŸ
                
                if (Math.sqrt(dx*dx + dy*dy) < hitDist) {
                    if (e.button === 2) { 
                        items.splice(i, 1);
                        draw();
                        return;
                    } else {
                        isDragging = true;
                        dragItem = item;
                        return;
                    }
                }
            }

            if (selectedTool && e.button === 0) {
                const newItem = {
                    ...selectedTool,
                    x: snapToGrid(pos.x),
                    y: snapToGrid(pos.y),
                    id: Date.now()
                };
                items.push(newItem);
                draw();
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging && dragItem) {
                const pos = getMousePos(e);
                dragItem.x = snapToGrid(pos.x);
                dragItem.y = snapToGrid(pos.y);
                draw();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            dragItem = null;
        });
        
        canvas.addEventListener('contextmenu', event => event.preventDefault());

        // åˆå§‹åŒ–
        setTimeout(resizeCanvas, 100); 
        // é è¨­ä¸æ”¾é›¶ä»¶ï¼Œè®“ç•«é¢ä¹¾æ·¨ï¼Œç­‰å¾…ä½¿ç”¨è€…æ“ä½œæˆ–é»æ“Šç¯„ä¾‹
        
    </script>
</body>
</html>